<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ponto Digital PRO</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root {
      --primary-color: #4361ee;
      --primary-light: #4895ef;
      --primary-dark: #3a0ca3;
      --success-color: #4cc9f0;
      --warning-color: #f72585;
      --secondary-color: #f8f9fa;
      --text-color: #2b2d42;
      --text-light: #8d99ae;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      --danger-color: #ef233c;
      --info-color: #4cc9f0;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #dfe7f5 100%);
      min-height: 100vh;
      color: var(--text-color);
      line-height: 1.6;
    }
    
    .app-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background: var(--primary-color);
      color: white;
      padding: 25px 0;
      border-radius: 0 0 20px 20px;
      box-shadow: var(--shadow);
      margin-bottom: 40px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--primary-light), var(--primary-dark));
    }
    
    h1 {
      margin: 0;
      font-weight: 600;
      font-size: 2.2rem;
      letter-spacing: 0.5px;
    }
    
    .user-info {
      margin-top: 15px;
      font-weight: 300;
      font-size: 1rem;
      opacity: 0.9;
    }
    
    .container {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      text-align: center;
    }
    
    .ponto-btn {
      padding: 18px 45px;
      font-size: 1.2rem;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 4px 8px rgba(67, 97, 238, 0.3);
      font-weight: 600;
      letter-spacing: 0.5px;
      position: relative;
      overflow: hidden;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 220px;
    }
    
    .ponto-btn:hover {
      background-color: var(--primary-dark);
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(67, 97, 238, 0.4);
    }
    
    .ponto-btn:active {
      transform: translateY(1px);
    }
    
    .ponto-btn i {
      margin-right: 10px;
      font-size: 1.3rem;
    }
    
    .status {
      margin-top: 25px;
      font-size: 1.1rem;
      color: var(--text-light);
    }
    
    .status strong {
      color: var(--primary-dark);
      font-weight: 500;
    }
    
    .history {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: var(--shadow);
    }
    
    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .history h3 {
      margin: 0;
      color: var(--primary-dark);
      font-weight: 600;
      font-size: 1.3rem;
    }
    
    #history-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 400px;
      overflow-y: auto;
    }
    
    #history-list li {
      padding: 15px 20px;
      margin-bottom: 10px;
      background: var(--secondary-color);
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: var(--transition);
    }
    
    #history-list li.entrada {
      border-left: 4px solid var(--success-color);
    }
    
    #history-list li.saida {
      border-left: 4px solid var(--warning-color);
    }
    
    #history-list li.intervalo {
      border-left: 4px solid var(--info-color);
    }
    
    #history-list li.hora-extra {
      border-left: 4px solid var(--danger-color);
    }
    
    .registro-info {
      display: flex;
      flex-direction: column;
    }
    
    .registro-horario {
      font-weight: 500;
      font-size: 1rem;
    }
    
    .registro-tipo {
      font-size: 0.85rem;
      color: var(--text-light);
      margin-top: 3px;
    }
    
    .registro-data {
      font-size: 0.85rem;
      color: var(--text-light);
    }
    
    .empty-history {
      color: var(--text-light);
      font-style: italic;
      text-align: center;
      padding: 30px;
      background: none;
      border: 1px dashed #ddd;
      border-radius: 10px;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 15px;
      max-width: 500px;
      width: 90%;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
      animation: modalFadeIn 0.3s ease-out;
    }
    
    @keyframes modalFadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .modal h2 {
      margin-top: 0;
      color: var(--primary-dark);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      transition: var(--transition);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      border-color: var(--primary-light);
      outline: none;
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }
    
    .modal-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    .modal-btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .modal-btn.cancel {
      background: #f1f1f1;
      color: var(--text-color);
      border: none;
    }
    
    .modal-btn.confirm {
      background: var(--primary-color);
      color: white;
      border: none;
    }
    
    .modal-btn:hover {
      opacity: 0.9;
    }
    
    .logout-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 8px 15px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    .send-report-btn {
      margin-top: 20px;
      padding: 12px 25px;
      background: var(--success-color);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .send-report-btn:hover {
      background: #3aa8d8;
    }
    
    .gestor-panel {
      margin-top: 30px;
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: var(--shadow);
    }
    
    .gestor-panel h3 {
      color: var(--primary-dark);
      margin-top: 0;
    }
    
    .gestor-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .gestor-btn {
      padding: 10px 15px;
      background: var(--primary-light);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .gestor-btn:hover {
      background: var(--primary-dark);
    }
    
    .colaboradores-list {
      margin-top: 20px;
    }
    
    .colaborador-item {
      padding: 15px;
      margin-bottom: 10px;
      background: var(--secondary-color);
      border-radius: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .colaborador-info {
      flex: 1;
    }
    
    .colaborador-nome {
      font-weight: 500;
    }
    
    .colaborador-email {
      font-size: 0.85rem;
      color: var(--text-light);
    }
    
    .colaborador-actions {
      display: flex;
      gap: 10px;
    }
    
    .location-status {
      margin-top: 10px;
      font-size: 0.9rem;
      color: var(--text-light);
    }
    
    .location-status.valid {
      color: var(--success-color);
    }
    
    .location-status.invalid {
      color: var(--warning-color);
    }
    
    .login-container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: var(--shadow);
    }
    
    .login-title {
      text-align: center;
      margin-bottom: 20px;
      color: var(--primary-dark);
    }
    
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .login-link {
      text-align: center;
      margin-top: 20px;
    }
    
    .login-link a {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .login-link a:hover {
      text-decoration: underline;
    }
    
    .time-summary {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      padding: 15px;
      background: var(--secondary-color);
      border-radius: 10px;
    }
    
    .time-card {
      text-align: center;
      flex: 1;
    }
    
    .time-card h4 {
      margin-bottom: 5px;
      color: var(--text-light);
      font-size: 0.9rem;
    }
    
    .time-card p {
      font-weight: 600;
      color: var(--primary-dark);
      font-size: 1.1rem;
    }
    
    .time-card.positive {
      color: var(--success-color);
    }
    
    .time-card.negative {
      color: var(--warning-color);
    }
    
    .justificativa-btn {
      margin-top: 10px;
      padding: 8px 15px;
      background: var(--warning-color);
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: var(--transition);
    }
    
    .justificativa-btn:hover {
      background: #d91a5b;
    }
    
    @media (max-width: 768px) {
      .app-container {
        padding: 15px;
      }
      
      header {
        padding: 20px 0;
        border-radius: 0 0 15px 15px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .container, .history, .login-container {
        padding: 20px;
      }
      
      .ponto-btn {
        padding: 15px 30px;
        font-size: 1.1rem;
        min-width: auto;
      }
      
      #history-list li {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .registro-data {
        margin-top: 5px;
      }
      
      .time-summary {
        flex-direction: column;
        gap: 10px;
      }
    }
    
    @keyframes highlight {
      0% { color: inherit; }
      50% { color: var(--primary-color); transform: scale(1.05); }
      100% { color: inherit; }
    }
  </style>
</head>
<body>

  <div class="app-container">
    <header>
      <button class="logout-btn" id="logout-btn" style="display: none;">
        <i class="fas fa-sign-out-alt"></i> Sair
      </button>
      <h1>Ponto Digital PRO</h1>
      <div class="user-info" id="user-info">Faça login para registrar seu ponto</div>
    </header>

    <!-- Tela de Login para Colaboradores -->
    <div id="auth-screen">
      <div class="login-container">
        <h2 class="login-title">Login do Colaborador</h2>
        <form id="login-form" class="login-form">
          <div class="form-group">
            <label for="login-email">E-mail</label>
            <input type="email" id="login-email" required placeholder="Digite seu e-mail cadastrado">
          </div>
          <div class="form-group">
            <label for="login-password">Senha</label>
            <input type="password" id="login-password" required placeholder="Digite sua senha">
          </div>
          <button type="submit" class="ponto-btn">
            <i class="fas fa-sign-in-alt"></i> Entrar
          </button>
        </form>
        <div class="login-link">
          É gestor? <a href="#" id="gestor-login-link">Acesse o painel administrativo</a>
        </div>
      </div>
    </div>

    <!-- Tela Principal para Colaboradores -->
    <div class="container" id="main-container" style="display: none;">
      <button class="ponto-btn" id="ponto-btn">
        <i class="fas fa-fingerprint"></i> Bater Ponto
      </button>
      <div class="status" id="status">Status: Aguardando primeiro registro</div>
      <div class="location-status" id="location-status"></div>
      
      <div class="time-summary" id="time-summary">
        <div class="time-card">
          <h4>Horas Trabalhadas</h4>
          <p id="horas-trabalhadas">00:00</p>
        </div>
        <div class="time-card">
          <h4>Horas Extras</h4>
          <p id="horas-extras">00:00</p>
        </div>
        <div class="time-card">
          <h4>Banco de Horas</h4>
          <p id="banco-horas">00:00</p>
        </div>
      </div>
      
      <button class="send-report-btn" id="send-report-btn">
        <i class="fas fa-paper-plane"></i> Enviar Espelho de Ponto
      </button>
      
      <button class="justificativa-btn" id="justificativa-btn" style="display: none;">
        <i class="fas fa-edit"></i> Justificar Ponto
      </button>
    </div>

    <div class="history" id="history-container" style="display: none;">
      <div class="history-header">
        <h3>Histórico do Dia</h3>
        <div id="total-hours">Horas trabalhadas: 00:00</div>
      </div>
      <ul id="history-list">
        <li class="empty-history">Nenhum registro hoje</li>
      </ul>
    </div>

    <!-- Painel do Gestor -->
    <div class="gestor-panel" id="gestor-panel" style="display: none;">
      <h3>Painel do Gestor</h3>
      <p>Bem-vindo, gestor. Aqui você pode gerenciar seus colaboradores.</p>
      
      <div class="gestor-actions">
        <button class="gestor-btn" id="add-colaborador-btn">
          <i class="fas fa-user-plus"></i> Adicionar Colaborador
        </button>
        <button class="gestor-btn" id="refresh-colaboradores-btn">
          <i class="fas fa-sync-alt"></i> Atualizar Lista
        </button>
        <button class="gestor-btn" id="config-jornada-btn">
          <i class="fas fa-clock"></i> Configurar Jornada
        </button>
      </div>
      
      <div class="colaboradores-list" id="colaboradores-list">
        <p>Carregando colaboradores...</p>
      </div>
    </div>

    <!-- Modal de login do gestor -->
    <div class="modal" id="gestor-login-modal">
      <div class="modal-content">
        <h2>Login do Gestor</h2>
        <form id="gestor-login-form">
          <div class="form-group">
            <label for="gestor-email">E-mail</label>
            <input type="email" id="gestor-email" required placeholder="Digite seu e-mail de gestor">
          </div>
          <div class="form-group">
            <label for="gestor-password">Senha</label>
            <input type="password" id="gestor-password" required placeholder="Digite sua senha">
          </div>
          <div class="modal-buttons">
            <button type="button" class="modal-btn cancel" id="cancel-gestor-login">Cancelar</button>
            <button type="submit" class="modal-btn confirm">Entrar</button>
          </div>
        </form>
        <div style="text-align: center; margin-top: 20px;">
          <a href="#" id="primeiro-acesso-gestor" style="color: var(--primary-color);">
            Primeiro acesso? Cadastre-se como gestor
          </a>
        </div>
      </div>
    </div>

    <!-- Modal de cadastro de gestor -->
    <div class="modal" id="gestor-cadastro-modal">
      <div class="modal-content">
        <h2>Cadastro de Gestor</h2>
        <form id="gestor-cadastro-form">
          <div class="form-group">
            <label for="gestor-cadastro-nome">Nome Completo</label>
            <input type="text" id="gestor-cadastro-nome" required>
          </div>
          <div class="form-group">
            <label for="gestor-cadastro-email">E-mail Corporativo</label>
            <input type="email" id="gestor-cadastro-email" required>
          </div>
          <div class="form-group">
            <label for="gestor-cadastro-senha">Senha (mínimo 8 caracteres)</label>
            <input type="password" id="gestor-cadastro-senha" required minlength="8">
          </div>
          <div class="modal-buttons">
            <button type="button" class="modal-btn cancel" id="cancel-gestor-cadastro">Cancelar</button>
            <button type="submit" class="modal-btn confirm">Cadastrar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal de adicionar colaborador -->
    <div class="modal" id="add-colaborador-modal">
      <div class="modal-content">
        <h2>Adicionar Colaborador</h2>
        <form id="colaborador-form">
          <div class="form-group">
            <label for="colaborador-nome">Nome Completo</label>
            <input type="text" id="colaborador-nome" placeholder="Digite o nome do colaborador" required>
          </div>
          <div class="form-group">
            <label for="colaborador-email">E-mail</label>
            <input type="email" id="colaborador-email" placeholder="Digite o e-mail do colaborador" required>
          </div>
          <div class="form-group">
            <label for="colaborador-password">Senha Inicial</label>
            <input type="password" id="colaborador-password" required 
                   placeholder="Defina a senha inicial" minlength="8">
          </div>
          <div class="form-group">
            <label for="colaborador-setor">Setor</label>
            <input type="text" id="colaborador-setor" placeholder="Digite o setor do colaborador" required>
          </div>
          <div class="form-group">
            <label for="colaborador-jornada">Jornada de Trabalho</label>
            <select id="colaborador-jornada" required>
              <option value="8">8 horas diárias (44h semanais)</option>
              <option value="6">6 horas diárias (36h semanais)</option>
              <option value="4">4 horas diárias (20h semanais)</option>
              <option value="custom">Personalizada</option>
            </select>
          </div>
          <div class="form-group">
            <label>Localização para bater ponto</label>
            <button type="button" class="gestor-btn" id="obter-localizacao-btn">
              <i class="fas fa-location-arrow"></i> Obter Minha Localização Atual
            </button>
            <div class="location-status" id="map-status">Clique no botão para obter sua localização atual</div>
            <input type="hidden" id="colaborador-latitude" required>
            <input type="hidden" id="colaborador-longitude" required>
          </div>
          <div class="form-group">
            <label for="colaborador-raio">Raio permitido (metros)</label>
            <input type="number" id="colaborador-raio" placeholder="Digite o raio em metros" value="100" required>
          </div>
          <div class="modal-buttons">
            <button type="button" class="modal-btn cancel" id="cancel-add-colaborador">Cancelar</button>
            <button type="submit" class="modal-btn confirm">Cadastrar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal de configuração de jornada -->
    <div class="modal" id="config-jornada-modal">
      <div class="modal-content">
        <h2>Configurar Jornada de Trabalho</h2>
        <form id="jornada-form">
          <div class="form-group">
            <label for="jornada-padrao">Jornada Padrão</label>
            <select id="jornada-padrao">
              <option value="8">8 horas diárias (44h semanais)</option>
              <option value="6">6 horas diárias (36h semanais)</option>
              <option value="4">4 horas diárias (20h semanais)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="intervalo-minimo">Intervalo Mínimo para Almoço (minutos)</label>
            <input type="number" id="intervalo-minimo" value="60" min="30">
          </div>
          <div class="form-group">
            <label for="tolerancia-atraso">Tolerância para Atraso (minutos)</label>
            <input type="number" id="tolerancia-atraso" value="10" min="0">
          </div>
          <div class="form-group">
            <label for="hora-extra-minima">Hora Extra Mínima Diária (minutos)</label>
            <input type="number" id="hora-extra-minima" value="15" min="0">
          </div>
          <div class="modal-buttons">
            <button type="button" class="modal-btn cancel" id="cancel-config-jornada">Cancelar</button>
            <button type="submit" class="modal-btn confirm">Salvar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal de justificativa -->
    <div class="modal" id="justificativa-modal">
      <div class="modal-content">
        <h2>Justificar Ponto</h2>
        <form id="justificativa-form">
          <div class="form-group">
            <label for="justificativa-data">Data</label>
            <input type="date" id="justificativa-data" required>
          </div>
          <div class="form-group">
            <label for="justificativa-horario">Horário</label>
            <input type="time" id="justificativa-horario" required>
          </div>
          <div class="form-group">
            <label for="justificativa-tipo">Tipo</label>
            <select id="justificativa-tipo" required>
              <option value="entrada">Entrada</option>
              <option value="saida">Saída</option>
              <option value="intervalo">Intervalo</option>
            </select>
          </div>
          <div class="form-group">
            <label for="justificativa-motivo">Motivo</label>
            <textarea id="justificativa-motivo" rows="4" required placeholder="Descreva o motivo da justificativa"></textarea>
          </div>
          <div class="modal-buttons">
            <button type="button" class="modal-btn cancel" id="cancel-justificativa">Cancelar</button>
            <button type="submit" class="modal-btn confirm">Enviar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal de envio de espelho -->
    <div class="modal" id="report-modal">
      <div class="modal-content">
        <h2>Enviar Espelho de Ponto</h2>
        <div class="form-group">
          <label for="report-start">Data Início</label>
          <input type="date" id="report-start" required>
        </div>
        <div class="form-group">
          <label for="report-end">Data Fim</label>
          <input type="date" id="report-end" required>
        </div>
        <div class="form-group">
          <label for="report-email">E-mail para envio</label>
          <input type="email" id="report-email" required>
        </div>
        <div class="modal-buttons">
          <button type="button" class="modal-btn cancel" id="cancel-report">Cancelar</button>
          <button type="button" class="modal-btn confirm" id="confirm-report">Enviar</button>
        </div>
      </div>
    </div>

    <script>
      // Configurações da API
      const API_BASE_URL = 'http://localhost:3000/api';
      
      // Variáveis de estado
      let currentUser = null;
      let token = null;
      let registrosHoje = [];
      let isGestor = false;
      
      // Elementos DOM
      const authScreen = document.getElementById('auth-screen');
      const loginForm = document.getElementById('login-form');
      const gestorLoginLink = document.getElementById('gestor-login-link');
      const gestorLoginModal = document.getElementById('gestor-login-modal');
      const gestorLoginForm = document.getElementById('gestor-login-form');
      const pontoBtn = document.getElementById('ponto-btn');
      const statusEl = document.getElementById('status');
      const locationStatusEl = document.getElementById('location-status');
      const historyList = document.getElementById('history-list');
      const userInfoEl = document.getElementById('user-info');
      const totalHoursEl = document.getElementById('total-hours');
      const mainContainer = document.getElementById('main-container');
      const historyContainer = document.getElementById('history-container');
      const gestorPanel = document.getElementById('gestor-panel');
      const colaboradoresList = document.getElementById('colaboradores-list');
      const logoutBtn = document.getElementById('logout-btn');
      const sendReportBtn = document.getElementById('send-report-btn');
      const addColaboradorBtn = document.getElementById('add-colaborador-btn');
      const refreshColaboradoresBtn = document.getElementById('refresh-colaboradores-btn');
      const configJornadaBtn = document.getElementById('config-jornada-btn');
      const addColaboradorModal = document.getElementById('add-colaborador-modal');
      const colaboradorForm = document.getElementById('colaborador-form');
      const obterLocalizacaoBtn = document.getElementById('obter-localizacao-btn');
      const reportModal = document.getElementById('report-modal');
      const confirmReportBtn = document.getElementById('confirm-report');
      const justificativaBtn = document.getElementById('justificativa-btn');
      const justificativaModal = document.getElementById('justificativa-modal');
      const configJornadaModal = document.getElementById('config-jornada-modal');
      const gestorCadastroModal = document.getElementById('gestor-cadastro-modal');
      const gestorCadastroForm = document.getElementById('gestor-cadastro-form');
      const primeiroAcessoGestor = document.getElementById('primeiro-acesso-gestor');
      const horasTrabalhadasEl = document.getElementById('horas-trabalhadas');
      const horasExtrasEl = document.getElementById('horas-extras');
      const bancoHorasEl = document.getElementById('banco-horas');

      // Funções auxiliares
      function formatTime(ms) {
        const horas = Math.floor(ms / (1000 * 60 * 60));
        const minutos = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));
        return `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}`;
      }

      function calcularDistancia(lat1, lon1, lat2, lon2) {
        const R = 6371e3;
        const φ1 = lat1 * Math.PI/180;
        const φ2 = lat2 * Math.PI/180;
        const Δφ = (lat2-lat1) * Math.PI/180;
        const Δλ = (lon2-lon1) * Math.PI/180;

        const a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
                  Math.cos(φ1) * Math.cos(φ2) *
                  Math.sin(Δλ/2) * Math.sin(Δλ/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

        return R * c;
      }

      // Funções de UI
      function updateUIAfterLogin() {
        authScreen.style.display = 'none';
        mainContainer.style.display = 'block';
        historyContainer.style.display = 'block';
        logoutBtn.style.display = 'block';
        
        if (isGestor) {
          gestorPanel.style.display = 'block';
          loadColaboradores();
        } else {
          gestorPanel.style.display = 'none';
          verificarLocalizacao();
        }
        
        userInfoEl.textContent = `${currentUser.nome} (${currentUser.setor})`;
      }

      async function loadRegistrosHoje() {
        try {
          const response = await fetch(`${API_BASE_URL}/registros/hoje`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            registrosHoje = data.registros;
            updateHistoryList();
            
            horasTrabalhadasEl.textContent = data.horasTrabalhadas;
            horasExtrasEl.textContent = data.horasExtras;
            bancoHorasEl.textContent = data.bancoHoras;
            totalHoursEl.textContent = `Horas trabalhadas: ${data.horasTrabalhadas}`;
            
            if (registrosHoje.length > 0) {
              const ultimoRegistro = registrosHoje[registrosHoje.length - 1];
              statusEl.innerHTML = `Status: Último registro foi <strong>${ultimoRegistro.tipo}</strong> às ${new Date(ultimoRegistro.timestamp).toLocaleTimeString()}`;
            }
          }
        } catch (error) {
          console.error('Erro ao carregar registros:', error);
        }
      }

      function updateHistoryList() {
        historyList.innerHTML = '';
        
        if (registrosHoje.length === 0) {
          historyList.innerHTML = '<li class="empty-history">Nenhum registro hoje</li>';
          return;
        }
        
        registrosHoje.forEach(registro => {
          const li = document.createElement('li');
          li.className = registro.tipo;
          
          const data = new Date(registro.timestamp);
          const dataFormatada = data.toLocaleDateString('pt-BR');
          const horaFormatada = data.toLocaleTimeString('pt-BR');
          
          li.innerHTML = `
            <div class="registro-info">
              <span class="registro-horario">${horaFormatada}</span>
              <span class="registro-tipo">${registro.tipo === 'entrada' ? 'Entrada' : registro.tipo === 'saida' ? 'Saída' : 'Intervalo'}</span>
            </div>
            <div class="registro-data">${dataFormatada}</div>
          `;
          
          historyList.appendChild(li);
        });
      }

      async function verificarLocalizacao() {
        if (!currentUser.latitude || !currentUser.longitude) {
          locationStatusEl.textContent = 'Localização não configurada - contate seu gestor';
          locationStatusEl.className = 'location-status invalid';
          pontoBtn.disabled = true;
          justificativaBtn.style.display = 'block';
          return;
        }

        try {
          const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, {
              enableHighAccuracy: true,
              timeout: 10000,
              maximumAge: 0
            });
          });

          const distance = calcularDistancia(
            position.coords.latitude,
            position.coords.longitude,
            currentUser.latitude,
            currentUser.longitude
          );

          if (distance <= (currentUser.raioPermitido || 100)) {
            locationStatusEl.textContent = `Você está no local permitido (${Math.round(distance)}m do ponto central)`;
            locationStatusEl.className = 'location-status valid';
            pontoBtn.disabled = false;
            justificativaBtn.style.display = 'none';
          } else {
            locationStatusEl.textContent = `Você está a ${Math.round(distance)}m do local permitido (máximo ${currentUser.raioPermitido || 100}m)`;
            locationStatusEl.className = 'location-status invalid';
            pontoBtn.disabled = true;
            justificativaBtn.style.display = 'block';
          }
        } catch (error) {
          console.error('Erro ao obter localização:', error);
          locationStatusEl.textContent = 'Erro ao verificar localização - ative a geolocalização';
          locationStatusEl.className = 'location-status invalid';
          pontoBtn.disabled = true;
          justificativaBtn.style.display = 'block';
        }
      }

      // Funções dos modais
      function openGestorLoginModal() {
        gestorLoginModal.style.display = 'flex';
      }

      function closeGestorLoginModal() {
        gestorLoginModal.style.display = 'none';
      }

      function openGestorCadastroModal() {
        gestorCadastroModal.style.display = 'flex';
        closeGestorLoginModal();
      }

      function closeGestorCadastroModal() {
        gestorCadastroModal.style.display = 'none';
      }

      function openAddColaboradorModal() {
        addColaboradorModal.style.display = 'flex';
      }

      function closeAddColaboradorModal() {
        addColaboradorModal.style.display = 'none';
      }

      function openConfigJornadaModal() {
        configJornadaModal.style.display = 'flex';
        loadJornadaConfig();
      }

      function closeConfigJornadaModal() {
        configJornadaModal.style.display = 'none';
      }

      function openJustificativaModal() {
        justificativaModal.style.display = 'flex';
        document.getElementById('justificativa-data').valueAsDate = new Date();
        document.getElementById('justificativa-horario').value = new Date().toTimeString().substring(0, 5);
      }

      function closeJustificativaModal() {
        justificativaModal.style.display = 'none';
      }

      function openReportModal() {
        reportModal.style.display = 'flex';
        const hoje = new Date();
        document.getElementById('report-start').valueAsDate = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
        document.getElementById('report-end').valueAsDate = hoje;
        document.getElementById('report-email').value = currentUser.email;
      }

      function closeReportModal() {
        reportModal.style.display = 'none';
      }

      // Funções de carregamento de dados
      async function loadColaboradores() {
        try {
          const response = await fetch(`${API_BASE_URL}/colaboradores`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            colaboradoresList.innerHTML = '';
            
            if (data.colaboradores.length === 0) {
              colaboradoresList.innerHTML = '<p>Nenhum colaborador cadastrado</p>';
              return;
            }
            
            data.colaboradores.forEach(colaborador => {
              const div = document.createElement('div');
              div.className = 'colaborador-item';
              
              div.innerHTML = `
                <div class="colaborador-info">
                  <div class="colaborador-nome">${colaborador.nome}</div>
                  <div class="colaborador-email">${colaborador.email} - ${colaborador.setor}</div>
                </div>
                <div class="colaborador-actions">
                  <button class="gestor-btn small" data-id="${colaborador.id}">
                    <i class="fas fa-eye"></i>
                  </button>
                </div>
              `;
              
              colaboradoresList.appendChild(div);
            });
          }
        } catch (error) {
          console.error('Erro ao carregar colaboradores:', error);
        }
      }

      async function loadJornadaConfig() {
        try {
          const response = await fetch(`${API_BASE_URL}/config/jornada`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          const data = await response.json();
          
          if (response.ok) {
            document.getElementById('jornada-padrao').value = data.config.horasDiarias;
            document.getElementById('intervalo-minimo').value = data.config.intervaloMinimo;
            document.getElementById('tolerancia-atraso').value = data.config.toleranciaAtraso;
            document.getElementById('hora-extra-minima').value = data.config.horaExtraMinima;
          }
        } catch (error) {
          console.error('Erro ao carregar configurações:', error);
        }
      }

      // Funções de manipulação de eventos
      async function handleColaboradorLogin(e) {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        try {
          const response = await fetch(`${API_BASE_URL}/auth/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
          });

          const data = await response.json();

          if (response.ok) {
            token = data.token;
            currentUser = data.user;
            isGestor = data.user.isGestor || false;
            
            localStorage.setItem('pontoToken', token);
            localStorage.setItem('pontoUser', JSON.stringify(currentUser));
            
            updateUIAfterLogin();
            await loadRegistrosHoje();
          } else {
            alert(data.message || 'Erro ao fazer login');
          }
        } catch (error) {
          console.error('Erro:', error);
          alert('Erro ao conectar com o servidor');
        }
      }

      async function handleGestorLogin(e) {
        e.preventDefault();
        const email = document.getElementById('gestor-email').value;
        const password = document.getElementById('gestor-password').value;

        try {
          const response = await fetch(`${API_BASE_URL}/auth/login-gestor`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ email, password })
          });

          const data = await response.json();

          if (response.ok) {
            token = data.token;
            currentUser = data.user;
            isGestor = true;
            
            localStorage.setItem('pontoToken', token);
            localStorage.setItem('pontoUser', JSON.stringify(currentUser));
            
            closeGestorLoginModal();
            updateUIAfterLogin();
          } else {
            alert(data.message || 'Erro ao fazer login como gestor');
          }
        } catch (error) {
          console.error('Erro:', error);
          alert('Erro ao conectar com o servidor');
        }
      }

      async function handleGestorCadastro(e) {
        e.preventDefault();
        const nome = document.getElementById('gestor-cadastro-nome').value;
        const email = document.getElementById('gestor-cadastro-email').value;
        const password = document.getElementById('gestor-cadastro-senha').value;

        try {
          const response = await fetch(`${API_BASE_URL}/auth/register-gestor`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ nome, email, password })
          });

          const data = await response.json();

          if (response.ok) {
            alert(data.message || 'Gestor cadastrado com sucesso');
            closeGestorCadastroModal();
            openGestorLoginModal();
          } else {
            alert(data.message || 'Erro ao cadastrar gestor');
          }
        } catch (error) {
          console.error('Erro:', error);
          alert('Erro ao conectar com o servidor');
        }
      }

      async function handleAddColaborador(e) {
        e.preventDefault();
        const nome = document.getElementById('colaborador-nome').value;
        const email = document.getElementById('colaborador-email').value;
        const password = document.getElementById('colaborador-password').value;
        const setor = document.getElementById('colaborador-setor').value;
        const latitude = document.getElementById('colaborador-latitude').value;
        const longitude = document.getElementById('colaborador-longitude').value;
        const raioPermitido = document.getElementById('colaborador-raio').value;
        const jornadaDiaria = document.getElementById('colaborador-jornada').value;

        try {
          const response = await fetch(`${API_BASE_URL}/colaboradores`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ 
              nome, 
              email, 
              password, 
              setor, 
              latitude, 
              longitude, 
              raioPermitido, 
              jornadaDiaria 
            })
          });

          const data = await response.json();

          if (response.ok) {
            alert(data.message || 'Colaborador cadastrado com sucesso');
            closeAddColaboradorModal();
            loadColaboradores();
          } else {
            alert(data.message || 'Erro ao cadastrar colaborador');
          }
        } catch (error) {
          console.error('Erro:', error);
          alert('Erro ao conectar com o servidor');
        }
      }

      async function handleConfigJornada(e) {
        e.preventDefault();
        const horasDiarias = document.getElementById('jornada-padrao').value;
        const intervaloMinimo = document.getElementById('intervalo-minimo').value;
        const toleranciaAtraso = document.getElementById('tolerancia-atraso').value;
        const horaExtraMinima = document.getElementById('hora-extra-minima').value;

        try {
          const response = await fetch(`${API_BASE_URL}/config/jornada`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ 
              horasDiarias, 
              intervaloMinimo, 
              toleranciaAtraso, 
              horaExtraMinima 
            })
          });

          const data = await response.json();

          if (response.ok) {
            alert(data.message || 'Configurações atualizadas com sucesso');
            closeConfigJornadaModal();
          } else {
            alert(data.message || 'Erro ao atualizar configurações');
          }
        } catch (error) {
          console.error('Erro:', error);
          alert('Erro ao conectar com o servidor');
        }
      }

      async function handleJustificativa(e) {
        e.preventDefault();
        const data = document.getElementById('justificativa-data').value;
        const horario = document.getElementById('justificativa-horario').value;
        const tipo = document.getElementById('justificativa-tipo').value;
        const motivo = document.getElementById('justificativa-motivo').value;

        try {
          const response = await fetch(`${API_BASE_URL}/registros/justificar`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ 
              data, 
              horario, 
              tipo, 
              motivo 
            })
          });

          const dataResponse = await response.json();

          if (response.ok) {
            alert(dataResponse.message || 'Justificativa enviada com sucesso');
            closeJustificativaModal();
          } else {
            alert(dataResponse.message || 'Erro ao enviar justificativa');
          }
        } catch (error) {
          console.error('Erro:', error);
          alert('Erro ao conectar com o servidor');
        }
      }

      async function handleSendReport() {
        const startDate = document.getElementById('report-start').value;
        const endDate = document.getElementById('report-end').value;
        const email = document.getElementById('report-email').value;

        try {
          const response = await fetch(`${API_BASE_URL}/registros/enviar-email`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ 
              userId: currentUser.id,
              startDate, 
              endDate, 
              email 
            })
          });

          const data = await response.json();

          if (response.ok) {
            alert(data.message || 'Espelho de ponto enviado com sucesso');
            closeReportModal();
          } else {
            alert(data.message || 'Erro ao enviar espelho de ponto');
          }
        } catch (error) {
          console.error('Erro:', error);
          alert('Erro ao conectar com o servidor');
        }
      }

      async function baterPonto() {
        try {
          const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, {
              enableHighAccuracy: true,
              timeout: 10000,
              maximumAge: 0
            });
          });

          const response = await fetch(`${API_BASE_URL}/registros`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
              latitude: position.coords.latitude,
              longitude: position.coords.longitude
            })
          });

          const data = await response.json();

          if (response.ok) {
            registrosHoje.push({
              tipo: data.tipo,
              timestamp: new Date().toISOString(),
              latitude: position.coords.latitude,
              longitude: position.coords.longitude
            });
            
            await loadRegistrosHoje();
            verificarLocalizacao();
          } else {
            alert(data.message || 'Erro ao bater ponto');
          }
        } catch (error) {
          console.error('Erro:', error);
          alert('Erro ao obter localização ou conectar com o servidor');
        }
      }

      function logout() {
        localStorage.removeItem('pontoToken');
        localStorage.removeItem('pontoUser');
        currentUser = null;
        token = null;
        isGestor = false;
        
        authScreen.style.display = 'block';
        mainContainer.style.display = 'none';
        historyContainer.style.display = 'none';
        gestorPanel.style.display = 'none';
        logoutBtn.style.display = 'none';
        
        document.getElementById('login-email').value = '';
        document.getElementById('login-password').value = '';
      }

      function checkAuth() {
        const storedToken = localStorage.getItem('pontoToken');
        const storedUser = localStorage.getItem('pontoUser');
        
        if (storedToken && storedUser) {
          token = storedToken;
          currentUser = JSON.parse(storedUser);
          isGestor = currentUser.isGestor || false;
          
          updateUIAfterLogin();
          loadRegistrosHoje();
        }
      }

      function obterLocalizacao() {
        const mapStatus = document.getElementById('map-status');
        mapStatus.textContent = 'Obtendo localização...';
        mapStatus.className = 'location-status';

        if (!navigator.geolocation) {
          mapStatus.textContent = 'Geolocalização não suportada pelo navegador';
          mapStatus.className = 'location-status invalid';
          return;
        }

        navigator.geolocation.getCurrentPosition(
          (position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            
            document.getElementById('colaborador-latitude').value = lat;
            document.getElementById('colaborador-longitude').value = lng;
            
            mapStatus.textContent = `Localização obtida: ${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            mapStatus.className = 'location-status valid';
          },
          (error) => {
            let errorMessage;
            switch(error.code) {
              case error.PERMISSION_DENIED:
                errorMessage = "Permissão de localização negada pelo usuário";
                break;
              case error.POSITION_UNAVAILABLE:
                errorMessage = "Informações de localização indisponíveis";
                break;
              case error.TIMEOUT:
                errorMessage = "A requisição de localização expirou";
                break;
              case error.UNKNOWN_ERROR:
                errorMessage = "Ocorreu um erro desconhecido";
                break;
            }
            mapStatus.textContent = `Erro: ${errorMessage}`;
            mapStatus.className = 'location-status invalid';
          },
          {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
          }
        );
      }

      // Event Listeners
      document.addEventListener('DOMContentLoaded', checkAuth);
      
      loginForm.addEventListener('submit', handleColaboradorLogin);
      gestorLoginLink.addEventListener('click', (e) => {
        e.preventDefault();
        openGestorLoginModal();
      });
      gestorLoginForm.addEventListener('submit', handleGestorLogin);
      document.getElementById('cancel-gestor-login').addEventListener('click', closeGestorLoginModal);
      
      primeiroAcessoGestor.addEventListener('click', (e) => {
        e.preventDefault();
        openGestorCadastroModal();
      });
      gestorCadastroForm.addEventListener('submit', handleGestorCadastro);
      document.getElementById('cancel-gestor-cadastro').addEventListener('click', closeGestorCadastroModal);
      
      pontoBtn.addEventListener('click', baterPonto);
      logoutBtn.addEventListener('click', logout);
      sendReportBtn.addEventListener('click', openReportModal);
      confirmReportBtn.addEventListener('click', handleSendReport);
      document.getElementById('cancel-report').addEventListener('click', closeReportModal);
      
      justificativaBtn.addEventListener('click', openJustificativaModal);
      document.getElementById('justificativa-form').addEventListener('submit', handleJustificativa);
      document.getElementById('cancel-justificativa').addEventListener('click', closeJustificativaModal);
      
      addColaboradorBtn.addEventListener('click', openAddColaboradorModal);
      refreshColaboradoresBtn.addEventListener('click', loadColaboradores);
      configJornadaBtn.addEventListener('click', openConfigJornadaModal);
      
      colaboradorForm.addEventListener('submit', handleAddColaborador);
      document.getElementById('cancel-add-colaborador').addEventListener('click', closeAddColaboradorModal);
      obterLocalizacaoBtn.addEventListener('click', obterLocalizacao);
      
      document.getElementById('jornada-form').addEventListener('submit', handleConfigJornada);
      document.getElementById('cancel-config-jornada').addEventListener('click', closeConfigJornadaModal);
    </script>
</body>
</html>